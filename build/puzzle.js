/* eslint-disable */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Puzzle=i()}(this,function(){"use strict";function r(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(){function n(t){if(function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),!(t.id&&t.imgUrl&&t.width&&t.height))return new Error("option不全");var i={limitNum:20};for(var e in t)i[e]=t[e];this.option=i,this.step=t.limitNum,this.init(i)}return function(t,i,e){i&&r(t.prototype,i),e&&r(t,e)}(n,[{key:"init",value:function(d){var l=this,t=document.getElementById(d.id),c=this.canvas=document.createElement("canvas");c.className="puzzle",c.width=d.width,c.height=d.height,t.appendChild(c);this.ctx=c.getContext("2d");var e=this.image=new Image;this.arr=[],this.indexArr=[],this.initArr=[],this.initIndex=[],this.Row=3,this.Column=3,this.IWidth,this.IHeight,this.PerCol,this.PerRow,this.CWidth=c.width,this.CHeight=c.height,e.onload=function(){l.IWidth=e.width,l.IHeight=e.height;for(var t=0;t<l.Row;t++)for(var i=0;i<l.Column;i++)l.arr.push([i,t]),l.initIndex.push(i+t*l.Row);l.initArr=JSON.parse(JSON.stringify(l.arr)),l.PerCol=l.IWidth/l.Column,l.PerRow=l.IHeight/l.Row,l.arr.sort(function(){return Math.random()-.5}),l.render(),l.getIndexArr()},e.src=d.imgUrl,c.addEventListener("click",function(t){var i=t.clientX,e=t.clientY,n=c.getBoundingClientRect(),r=i-n.left-document.documentElement.clientLeft,h=e-n.top-document.documentElement.clientTop;r=r*c.width/n.width,h=h*c.height/n.height;var s=l.getIndex(r,h),o=l.indexArr.indexOf(l.arr.length-1),a=l.initArr[s],u=l.initArr[o];if(1==l.distance(a,u)){if(0==l.step)return;l.swapArr(s,o),l.render(),l.getIndexArr(),l.step-=1,d.every&&d.every(l.step),l.indexArr.join("")==l.initIndex.join("")?(console.log("完成"),d.success&&d.success()):l.step<=0&&d.fail&&d.fail()}})}},{key:"getIndex",value:function(t,i){var e=Math.floor(i/(this.CHeight/this.Row));return Math.floor(t/(this.CWidth/this.Column))+e*this.Row}},{key:"getIndexArr",value:function(){for(var t=[],i=0;i<this.arr.length;i++)t.push(this.arr[i][0]+this.arr[i][1]*this.Row);this.indexArr=t}},{key:"swapArr",value:function(t,i){this.arr[t]=this.arr.splice(i,1,this.arr[t])[0]}},{key:"distance",value:function(t,i){return Math.abs(t[0]-i[0])+Math.abs(t[1]-i[1])}},{key:"render",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.style.display="none",this.canvas.offsetHeight,this.canvas.style.display="inherit";for(var t=0;t<this.arr.length;t++){var i=this.arr[t],e=Math.ceil((t+1)/this.Row)-1,n=t%this.Row;this.ctx.drawImage(this.image,this.PerCol*i[0],this.PerRow*i[1],this.IWidth/this.Column,this.IHeight/this.Row,this.CWidth/this.Column*n,this.CHeight/this.Row*e,this.CWidth/this.Column,this.CHeight/this.Row)}}},{key:"recovery",value:function(){this.arr.sort(function(){return Math.random()-.5}),this.render(),this.getIndexArr(),this.step=this.option.limitNum}}]),n}()});
