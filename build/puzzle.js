/* eslint-disable */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Puzzle=t()}(this,function(){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(){function i(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),console.log(123),!(e.id&&e.imgUrl&&e.width&&e.height))return new Error("option不全");var t={limitNum:20};for(var n in e)t[n]=e[n];this.option=t,this.step=e.limitNum,this.init(t)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(i,[{key:"init",value:function(l){var u=this,e=document.getElementById(l.id),f=document.createElement("canvas");f.className="puzzle",f.width=l.width,f.height=l.height,e.appendChild(f);var o,r,a,c,s=f.getContext("2d"),h=new Image,d=[],p=[],m=[],g=[],v=3,y=3,w=f.width,b=f.height;function E(){for(var e=[],t=0;t<d.length;t++)e.push(d[t][0]+d[t][1]*v);p=e}function M(){s.clearRect(0,0,f.width,f.height),f.style.display="none",f.offsetHeight,f.style.display="inherit";for(var e=0;e<d.length;e++){var t=d[e],n=Math.ceil((e+1)/v)-1,i=e%v;s.drawImage(h,a*t[0],c*t[1],o/y,r/v,w/y*i,b/v*n,w/y,b/v)}}h.onload=function(){o=h.width,r=h.height;for(var e=0;e<v;e++)for(var t=0;t<y;t++)d.push([t,e]),g.push(t+e*v);m=JSON.parse(JSON.stringify(d)),a=o/y,c=r/v,d.sort(function(){return Math.random()-.5}),M(),E()},h.src=l.imgUrl,f.addEventListener("click",function(e){var t=e.clientX,n=e.clientY,i=f.getBoundingClientRect(),o=t-i.left-document.documentElement.clientLeft,r=n-i.top-document.documentElement.clientTop,a=function(e,t){var n=Math.floor(t/(b/v));return Math.floor(e/(w/y))+n*v}(o=o*f.width/i.width,r=r*f.height/i.height),c=p.indexOf(d.length-1);if(1==function(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}(m[a],m[c])){if(0==u.step)return;!function(e,t){d[e]=d.splice(t,1,d[e])[0]}(a,c),M(),E(),u.step-=1,l.every&&l.every(u.step),p.join("")==g.join("")?(console.log("完成"),l.success&&l.success()):u.step<=0&&l.fail&&l.fail()}})}},{key:"recovery",value:function(){this.step=this.option.limitNum}}]),i}()});
