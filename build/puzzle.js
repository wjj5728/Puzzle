/* eslint-disable */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Puzzle=i()}(this,function(){"use strict";function n(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(){function s(t){if(function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),!(t.id&&t.imgUrl&&t.width&&t.height))return new Error("option不全");var i={limitNum:200};for(var e in t)i[e]=t[e];this.option=i,this.step=t.limitNum,this.init(i)}return function(t,i,e){i&&n(t.prototype,i),e&&n(t,e)}(s,[{key:"init",value:function(l){var u=this,t=document.getElementById(l.id),d=this.canvas=document.createElement("canvas");d.className="canvas-puzzle",d.width=l.width,d.height=l.height,t.appendChild(d);this.ctx=d.getContext("2d");var e=this.image=new Image;this.option=l,this.arr=[],this.indexArr=[],this.initArr=[],this.initIndex=[],this.Row=3,this.Column=3,this.IWidth,this.IHeight,this.PerCol,this.PerRow,this.CWidth=d.width,this.CHeight=d.height,this.block=8,this.isFinish=!1,e.onload=function(){u.IWidth=e.width,u.IHeight=e.height;for(var t=0;t<u.Row;t++)for(var i=0;i<u.Column;i++)u.arr.push([i,t]),u.initIndex.push(i+t*u.Row);u.initArr=JSON.parse(JSON.stringify(u.arr)),u.PerCol=u.IWidth/u.Column,u.PerRow=u.IHeight/u.Row,u.upset(),u.getIndexArr(),u.render()},e.src=l.imgUrl,d.addEventListener("click",function(t){if(!u.isFinish){var i=t.clientX,e=t.clientY,s=d.getBoundingClientRect(),n=i-s.left-document.documentElement.clientLeft,h=e-s.top-document.documentElement.clientTop;n=n*d.width/s.width,h=h*d.height/s.height;var r=u.getIndex(n,h),o=u.indexArr.indexOf(u.arr.length-1),a=u.initArr[r],c=u.initArr[o];if(1==u.distance(a,c)){if(0==u.step)return;u.swapArr(r,o),u.getIndexArr(),u.render(),u.step-=1,l.every&&l.every(u.step),u.indexArr.join("")==u.initIndex.join("")?l.success&&l.success():u.step<=0&&l.fail&&l.fail()}}})}},{key:"getIndex",value:function(t,i){var e=Math.floor(i/(this.CHeight/this.Row));return Math.floor(t/(this.CWidth/this.Column))+e*this.Row}},{key:"getIndexArr",value:function(){for(var t=[],i=0;i<this.arr.length;i++)t.push(this.arr[i][0]+this.arr[i][1]*this.Row);this.indexArr=t,this.indexArr.join("")==this.initIndex.join("")?this.isFinish=!0:this.isFinish=!1}},{key:"swapArr",value:function(t,i){this.block=t,this.arr[t]=this.arr.splice(i,1,this.arr[t])[0]}},{key:"distance",value:function(t,i){return Math.abs(t[0]-i[0])+Math.abs(t[1]-i[1])}},{key:"upset",value:function(){this.arr.sort(function(){return Math.random()-.5});for(var t=0;t<this.arr.length;t++)2==this.arr[t][0]&&2==this.arr[t][1]&&(this.block=t)}},{key:"render",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.style.display="none",this.canvas.offsetHeight,this.canvas.style.display="inherit";for(var t=0;t<this.arr.length;t++){var i=this.arr[t],e=Math.ceil((t+1)/this.Row)-1,s=t%this.Row;this.block!=t||this.isFinish?this.ctx.globalAlpha=1:(this.ctx.globalAlpha=0,this.ctx.beginPath()),this.ctx.drawImage(this.image,this.PerCol*i[0],this.PerRow*i[1],this.IWidth/this.Column,this.IHeight/this.Row,this.CWidth/this.Column*s,this.CHeight/this.Row*e,this.CWidth/this.Column,this.CHeight/this.Row),this.block!=t||this.isFinish||(this.ctx.closePath(),this.ctx.save())}}},{key:"recovery",value:function(){this.upset(),this.getIndexArr(),this.render(),this.step=this.option.limitNum}},{key:"vip",value:function(){this.isFinish=!0,this.arr=JSON.parse(JSON.stringify(this.initArr)),this.render(),this.option.success&&this.option.success()}}]),s}()});
